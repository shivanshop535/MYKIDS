<!DOCTYPE html>
<html lang="en">
<head>
    <!-- existing head content -->
    <style>
        /* existing styles */
        .quality-selector {
            position: absolute;
            top: 50px;
            right: 10px;
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            padding: 10px;
            border-radius: 5px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <!-- existing body content -->
    <div class="quality-selector" id="quality-selector" style="display: none;">
        <select id="qualitySelector"></select>
    </div>

    <script>
        // existing JavaScript code

        // Add quality selection to manifest parsing event
        hls.on(Hls.Events.MANIFEST_PARSED, function(event, data) {
            logMessage('HLS.js is parsing the manifest...');

            // Enable quality track switching
            if (data.levels && data.levels.length > 1) {
                logMessage('Multiple quality levels found.');
                const qualitySelector = document.getElementById('qualitySelector');
                data.levels.forEach((level, index) => {
                    const option = document.createElement('option');
                    option.value = index;
                    option.innerText = level.height ? `${level.height}p` : `Level ${index + 1}`;
                    qualitySelector.appendChild(option);
                });

                // Show the quality selector
                document.getElementById('quality-selector').style.display = 'block';

                qualitySelector.addEventListener('change', function() {
                    const qualityIndex = qualitySelector.value;
                    hls.currentLevel = qualityIndex;
                    logMessage('Switched to quality level: ' + qualityIndex);
                });
            }

            // existing audio track handling code here
        });

        // existing CORS and HLS.js setup code here
    </script>
</body>
</html>
